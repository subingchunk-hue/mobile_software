<!--pages/photo-album/photo-album.wxml-->
<view class="page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ç›¸å†Œé›†</text>
  </view>

  <!-- ç›¸å†Œå†…å®¹ -->
  <view class="album-container">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{albumGroups.length === 0}}">
      <text class="empty-text">è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•ç…§ç‰‡</text>
      <text class="empty-tip">åœ¨æ·»åŠ å›žå¿†æ—¶ä¸Šä¼ ç…§ç‰‡ï¼Œç…§ç‰‡ä¼šè‡ªåŠ¨å½’ç±»åˆ°è¿™é‡Œ</text>
    </view>

    <!-- ç›¸å†Œåˆ†ç»„åˆ—è¡¨ -->
    <view wx:else>
      <view class="album-group" wx:for="{{albumGroups}}" wx:key="title" wx:for-index="index">
        <view class="group-header">
          <text class="group-title">{{item.title}}</text>
          <view class="header-right">
            <text class="photo-count">{{item.images.length}}å¼ ç…§ç‰‡</text>
            <view class="export-btn" bindtap="exportMemory" data-index="{{index}}">
              <text class="export-icon">ðŸ“¤</text>
            </view>
          </view>
        </view>
        
        <!-- å›žå¿†è¯¦æƒ… -->
        <view class="memory-details" wx:if="{{item.description || item.mood || item.time || item.semester}}">
          <text class="memory-description" wx:if="{{item.description}}">{{item.description}}</text>
          <text class="memory-mood" wx:if="{{item.mood}}">å¿ƒæƒ…ï¼š{{item.mood}}</text>
          <text class="memory-semester" wx:if="{{item.semester}}">å­¦æœŸï¼š{{item.semester}}</text>
          <text class="memory-time" wx:if="{{item.time}}">æ—¶é—´ï¼š{{item.time}}</text>
        </view>
        
        <!-- ç…§ç‰‡ç½‘æ ¼ -->
        <view class="photo-grid" data-count="{{item.images.length}}">
          <image 
            class="photo-item" 
            wx:for="{{item.images}}" 
            wx:for-item="imageUrl" 
            wx:key="*this"
            src="{{imageUrl}}"
            mode="aspectFill"
            bindtap="previewPhoto"
            data-current="{{imageUrl}}"
            data-urls="{{item.images}}"
          />
        </view>
      </view>
    </view>
  </view>
  
  <!-- éšè—çš„ç”»å¸ƒï¼Œç”¨äºŽç”Ÿæˆå¯¼å‡ºå›¾ç‰‡ -->
  <canvas 
    canvas-id="exportCanvas" 
    style="width: 750px; height: 1000px; position: fixed; top: -2000px; left: -2000px;"
  ></canvas>
</view>